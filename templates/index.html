{% extends "base.html" %}

{% block content %}
  <div class="card">
    <h1>Hotel Booking System</h1>
    <p class="hint">Students can interact with the system without viewing the Python code. For testing, record inputs and outputs.</p>
  </div>

  <div class="card">
    <h2>Make a Booking</h2>
    <form method="post" action="{{ url_for('book') }}">
      <div class="grid">
        <div>
          <label for="name">Guest name</label>
          <input id="name" name="name" placeholder="e.g., Alex" required>
        </div>

        <div>
          <label for="room_type">Room type (standard / family / suite)</label>
          <input id="room_type" name="room_type" list="roomtypes" placeholder="standard" required>
          <datalist id="roomtypes">
            {% for room in rooms.keys() %}
              <option value="{{ room }}"></option>
            {% endfor %}
          </datalist>
        </div>

        <div>
          <label for="season">Season (low / high)</label>
          <input id="season" name="season" list="seasons" placeholder="low" required>
          <datalist id="seasons">
            {% for s in season_multiplier.keys() %}
              <option value="{{ s }}"></option>
            {% endfor %}
          </datalist>
        </div>

        <div class="row">
          <div>
            <label for="nights">Nights</label>
            <input id="nights" name="nights" type="number" min="0" placeholder="1" required>
          </div>
          <div>
            <label for="guests">Guests</label>
            <input id="guests" name="guests" type="number" min="0" placeholder="2" required>
          </div>
        </div>

        <div>
          <label for="breakfast">Breakfast? (yes/no)</label>
          <input id="breakfast" name="breakfast" list="yesno" placeholder="no" required>
        </div>

        <div>
          <label for="promo_code">Promo code (optional)</label>
          <input id="promo_code" name="promo_code" placeholder="SAVE10">
        </div>
      </div>

      <datalist id="yesno">
        <option value="yes"></option>
        <option value="no"></option>
      </datalist>

      <div style="margin-top: 14px; display:flex; gap: 10px; align-items:center;">
        <button class="btn btn-primary" type="submit">Submit booking</button>
        <span class="hint">Tip: Try boundary values (e.g., max guests, 5 nights, subtotal near 300).</span>
      </div>
    </form>
  </div>

  <div class="card">
    <div style="display:flex; justify-content: space-between; align-items: baseline; gap: 10px;">
      <h2>Booking Summary</h2>
      <div class="hint">Total bookings recorded: {{ total_bookings }}</div>
    </div>

    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Room</th>
          <th>Season</th>
          <th>Nights</th>
          <th>Guests</th>
          <th>Breakfast</th>
          <th>Promo</th>
          <th>Total (CHF)</th>
        </tr>
      </thead>
      <tbody>
        {% if bookings|length == 0 %}
          <tr><td colspan="9">No bookings to display.</td></tr>
        {% else %}
          {% for b in bookings %}
            <tr>
              <td>{{ loop.index }}</td>
              <td>{{ b.name }}</td>
              <td>{{ b.room_type }}</td>
              <td>{{ b.season }}</td>
              <td>{{ b.nights }}</td>
              <td>{{ b.guests }}</td>
              <td>{{ 'yes' if b.breakfast else 'no' }}</td>
              <td>{{ b.promo_code if b.promo_code else '-' }}</td>
              <td>{{ '%.2f'|format(b.total_cost) }}</td>
            </tr>
          {% endfor %}
        {% endif %}
      </tbody>
    </table>

    <form method="post" action="{{ url_for('reset') }}" style="margin-top: 12px;">
      <button class="btn btn-secondary" type="submit">Reset all bookings</button>
    </form>
  </div>

  <div class="card">
    <h2>Room rules</h2>
    <table>
      <thead>
        <tr>
          <th>Room</th>
          <th>Max guests</th>
          <th>Nightly rate (CHF)</th>
        </tr>
      </thead>
      <tbody>
        {% for room, data in rooms.items() %}
          <tr>
            <td>{{ room }}</td>
            <td>{{ data.max_guests }}</td>
            <td>{{ '%.2f'|format(data.nightly_rate) }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <p class="hint" style="margin-top:10px;">Season multipliers: low={{ season_multiplier['low'] }}, high={{ season_multiplier['high'] }}.</p>
  </div>
{% endblock %}
